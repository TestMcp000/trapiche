# Import/Export (Admin-only) â€” Technical Spec

> Status: Stable  
> Last Updated: 2026-01-02  
> Note: this is the canonical technical spec; design rationale lives in `IMPORT_EXPORT.md`.

Links:

- Implemented behavior (SSoT): `../../SPEC.md#importexport-admin-only`
- PRD / design rationale: `IMPORT_EXPORT.md`

---

## 1. è³‡æ–™é¡å‹ç¸½è¦½

| è³‡æ–™é¡å‹                | Export | Import | æ ¼å¼     | CSV | UI ä½ç½®                         |
| ----------------------- | ------ | ------ | -------- | --- | ------------------------------- |
| Blog Posts              | âœ“      | âœ“      | Markdown | âœ—   | `/admin/posts` + ç·¨è¼¯é          |
| Blog Categories         | âœ“      | âœ“      | JSON     | âœ—   | `/admin/categories`             |
| Gallery Items           | âœ“      | âœ“      | JSON     | âœ—   | `/admin/gallery`                |
| Gallery Categories      | âœ“      | âœ“      | JSON     | âœ—   | `/admin/gallery/categories`     |
| Productsï¼ˆå« Variantsï¼‰ | âœ“      | âœ“      | JSON     | âœ“   | `/admin/shop/products` + ç·¨è¼¯é  |
| Coupons                 | âœ“      | âœ“      | JSON     | âœ“   | `/admin/shop/coupons`           |
| Orders                  | âœ“      | âœ—      | JSON     | âœ“   | `/admin/shop/orders`            |
| Members                 | âœ“      | âœ—      | JSON     | âœ“   | `/admin/shop/members`           |
| Site Content            | âœ“      | âœ“      | JSON     | âœ—   | `/admin/content`                |
| Landing Sections        | âœ“      | âœ“      | JSON     | âœ—   | `/admin/landing`                |
| Comments                | âœ“      | âœ—      | JSON     | âœ“   | `/admin/comments`               |

**CSV æ ¼å¼èªªæ˜**ï¼š

- âœ“ CSVï¼šæ‰å¹³çµæ§‹ã€å¸¸éœ€ Excel åˆ†æï¼ˆè¨‚å–®å ±è¡¨ã€æœƒå“¡åå–®ã€åº«å­˜ç›¤é»ã€å„ªæƒ ç¢¼ç®¡ç†ï¼‰
- âœ— CSVï¼šå·¢ç‹€çµæ§‹æˆ–é•·æ–‡æœ¬ï¼ˆæ–‡ç« å…§å®¹ã€æè¿°ã€ç¶²ç«™è¨­å®šï¼‰
- CSV åƒ…æ”¯æ´åŒ¯å‡ºï¼Œä¸æ”¯æ´åŒ¯å…¥

> Implementation noteï¼ˆ2025-12-31ï¼‰ï¼šç›®å‰ bulk åŒ¯å…¥/åŒ¯å‡ºå…¥å£é›†ä¸­æ–¼ `/admin/import-export`ï¼›CSV åŒ¯å‡ºå·²è½åœ°ï¼›Job History ç›®å‰æ¶µè“‹ Products/Coupons/Orders/Members/Comments çš„ `export*WithJob`ï¼ˆå¯é‡ä¸‹è¼‰/åˆªé™¤ï¼‰ï¼ŒBlog/Gallery/Content ä»ç‚º legacy signed URL exportã€‚

---

## 2. æ ¼å¼è¦æ ¼

### 2.1 Blog Postsï¼ˆMarkdownï¼‰

**ç”¨é€”**ï¼šå…§å®¹ç·¨è¼¯ã€ç‰ˆæœ¬æ§åˆ¶ï¼ˆGitï¼‰ã€éœæ…‹ç¶²ç«™é·ç§»

**å–®æª”æ ¼å¼**ï¼ˆYAML frontmatter + é›™èªå…§å®¹ï¼‰ï¼š

```markdown
---
slug: my-first-post
category: tech
visibility: public
created_at: 2025-01-01T00:00:00Z
title_en: My First Post
title_zh: æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« 
excerpt_en: A short summary...
excerpt_zh: ç°¡çŸ­æ‘˜è¦...
cover_image_url_en: https://res.cloudinary.com/...
cover_image_url_zh: https://res.cloudinary.com/...
cover_image_alt_en: Description of image
cover_image_alt_zh: åœ–ç‰‡æè¿°
---

<!-- lang: en -->

# My First Post

English content here...

<!-- lang: zh -->

# æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« 

ä¸­æ–‡å…§å®¹åœ¨é€™è£¡...
```

**æ‰¹é‡åŒ¯å‡ºçµæ§‹**ï¼ˆ.zipï¼‰ï¼š

```
blog_posts_2025-12-27.zip
â”œâ”€â”€ tech/
â”‚   â”œâ”€â”€ my-first-post.md
â”‚   â””â”€â”€ another-post.md
â””â”€â”€ lifestyle/
    â””â”€â”€ travel-guide.md
```

**åŒ¯å…¥é‚è¼¯**ï¼š

1. è§£æ frontmatter å–å¾— metadata
2. ç”¨ `<!-- lang: en -->` å’Œ `<!-- lang: zh -->` åˆ†éš”ç¬¦è§£æé›™èªå…§å®¹
3. ç”¨ `category` slug æŸ¥æ‰¾å°æ‡‰çš„ `category_id`
4. è‹¥ category ä¸å­˜åœ¨ â†’ å ±éŒ¯

---

### 2.2 Blog Categoriesï¼ˆJSONï¼‰

```json
{
  "exportedAt": "2025-12-27T10:00:00Z",
  "type": "blog_categories",
  "data": [
    {
      "slug": "tech",
      "name_en": "Technology",
      "name_zh": "ç§‘æŠ€"
    },
    {
      "slug": "lifestyle",
      "name_en": "Lifestyle",
      "name_zh": "ç”Ÿæ´»"
    }
  ]
}
```

---

### 2.3 Gallery Itemsï¼ˆJSONï¼‰

```json
{
  "exportedAt": "2025-12-27T10:00:00Z",
  "type": "gallery_items",
  "data": [
    {
      "slug": "sunset-photo",
      "category": "nature",
      "title_en": "Sunset",
      "title_zh": "å¤•é™½",
      "description_en": "A beautiful sunset",
      "description_zh": "ç¾éº—çš„å¤•é™½",
      "image_url": "https://res.cloudinary.com/...",
      "image_alt_en": "Sunset over the ocean",
      "image_alt_zh": "æµ·ä¸Šå¤•é™½",
      "material_en": "Oil on canvas",
      "material_zh": "æ²¹ç•«",
      "tags_en": ["nature", "sunset"],
      "tags_zh": ["è‡ªç„¶", "å¤•é™½"],
      "is_visible": true
    }
  ]
}
```

---

### 2.4 Gallery Categoriesï¼ˆJSONï¼‰

```json
{
  "exportedAt": "2025-12-27T10:00:00Z",
  "type": "gallery_categories",
  "data": [
    {
      "slug": "nature",
      "name_en": "Nature",
      "name_zh": "è‡ªç„¶",
      "sort_order": 1,
      "is_visible": true
    }
  ]
}
```

---

### 2.5 Productsï¼ˆJSONï¼Œå« Variantsï¼‰

```json
{
  "exportedAt": "2025-12-27T10:00:00Z",
  "type": "products",
  "data": [
    {
      "slug": "handmade-bag",
      "category": "accessories",
      "name_en": "Handmade Bag",
      "name_zh": "æ‰‹å·¥åŒ…",
      "description_short_en": "A beautiful handmade bag",
      "description_short_zh": "ç²¾ç¾æ‰‹å·¥åŒ…",
      "description_full_en": "# About\n\nMarkdown content...",
      "description_full_zh": "# é—œæ–¼\n\nMarkdown å…§å®¹...",
      "cover_image_url": "https://res.cloudinary.com/...",
      "media_urls": ["https://...", "https://..."],
      "tags_en": ["handmade", "leather"],
      "tags_zh": ["æ‰‹å·¥", "çš®é©"],
      "is_visible": true,
      "sort_order": 1,
      "variants": [
        {
          "variant_key": "red-small",
          "option_values": { "color": "red", "size": "small" },
          "sku": "HB-RED-S",
          "price_cents": 150000,
          "compare_at_price_cents": null,
          "stock": 10,
          "is_enabled": true
        },
        {
          "variant_key": "blue-large",
          "option_values": { "color": "blue", "size": "large" },
          "sku": "HB-BLUE-L",
          "price_cents": 180000,
          "compare_at_price_cents": 200000,
          "stock": 5,
          "is_enabled": true
        }
      ]
    }
  ]
}
```

---

### 2.6 Couponsï¼ˆJSONï¼‰

```json
{
  "exportedAt": "2025-12-27T10:00:00Z",
  "type": "coupons",
  "data": [
    {
      "code": "SUMMER2025",
      "discount_type": "percentage",
      "discount_value": 10,
      "min_order_cents": 100000,
      "max_uses": 100,
      "used_count": 25,
      "starts_at": "2025-06-01T00:00:00Z",
      "expires_at": "2025-08-31T23:59:59Z",
      "is_active": true
    }
  ]
}
```

---

### 2.7 Ordersï¼ˆJSONï¼Œå”¯è®€åŒ¯å‡ºï¼‰

```json
{
  "exportedAt": "2025-12-27T10:00:00Z",
  "type": "orders",
  "includeSensitive": false,
  "data": [
    {
      "order_number": "ORD-20251227-001",
      "status": "completed",
      "gateway": "stripe",
      "subtotal_cents": 300000,
      "discount_cents": 30000,
      "total_cents": 270000,
      "currency": "TWD",
      "coupon_code": "SUMMER2025",
      "created_at": "2025-12-27T10:00:00Z",
      "paid_at": "2025-12-27T10:05:00Z",
      "items": [
        {
          "product_slug": "handmade-bag",
          "variant_key": "red-small",
          "quantity": 2,
          "unit_price_cents": 150000
        }
      ]
    }
  ]
}
```

**æ•æ„Ÿæ¬„ä½**ï¼ˆ`includeSensitive: true` æ™‚æ‰åŒ…å«ï¼‰ï¼š

- `recipient_name`
- `recipient_phone`
- `recipient_address`
- `invoice_data`
- `gateway_transaction_id`

---

### 2.8 Membersï¼ˆJSONï¼Œå”¯è®€åŒ¯å‡ºï¼‰

```json
{
  "exportedAt": "2025-12-27T10:00:00Z",
  "type": "members",
  "includeSensitive": false,
  "data": [
    {
      "display_name": "John Doe",
      "order_count": 5,
      "ltv_cents": 750000,
      "first_order_at": "2025-01-15T00:00:00Z",
      "last_order_at": "2025-12-20T00:00:00Z",
      "tags": ["vip", "repeat-buyer"],
      "is_blocked": false
    }
  ]
}
```

**æ•æ„Ÿæ¬„ä½**ï¼ˆ`includeSensitive: true` æ™‚æ‰åŒ…å«ï¼‰ï¼š

- `email`
- `phone`
- `address_json`

---

### 2.9 Site Contentï¼ˆJSONï¼‰

```json
{
  "exportedAt": "2025-12-27T10:00:00Z",
  "type": "site_content",
  "data": [
    {
      "section_key": "hero",
      "is_published": true,
      "content_en": {
        "title": "Welcome",
        "subtitle": "Your journey starts here"
      },
      "content_zh": {
        "title": "æ­¡è¿",
        "subtitle": "æ‚¨çš„æ—…ç¨‹å¾é€™è£¡é–‹å§‹"
      }
    }
  ]
}
```

---

### 2.10 Landing Sectionsï¼ˆJSONï¼‰

```json
{
  "exportedAt": "2025-12-27T10:00:00Z",
  "type": "landing_sections",
  "data": [
    {
      "section_key": "hero",
      "section_type": "text_image",
      "sort_order": 1,
      "is_visible": true,
      "title_en": "Welcome",
      "title_zh": "æ­¡è¿",
      "subtitle_en": "Your journey starts here",
      "subtitle_zh": "æ‚¨çš„æ—…ç¨‹å¾é€™è£¡é–‹å§‹",
      "content_en": {
        "body": "Markdown content...",
        "image_url": "https://...",
        "image_position": "right"
      },
      "content_zh": {
        "body": "Markdown å…§å®¹...",
        "image_url": "https://...",
        "image_position": "right"
      }
    }
  ]
}
```

---

### 2.11 Commentsï¼ˆJSONï¼Œå”¯è®€åŒ¯å‡ºï¼‰

**target_type æ”¯æ´**ï¼š`post` | `gallery_item` | `product`

```json
{
  "exportedAt": "2025-12-27T10:00:00Z",
  "type": "comments",
  "includeSensitive": false,
  "data": [
    {
      "target_type": "post", // or "gallery_item" or "product"
      "target_slug": "my-first-post",
      "user_display_name": "John",
      "content": "Great post!",
      "is_approved": true,
      "like_count": 5,
      "created_at": "2025-12-27T10:00:00Z",
      "replies": [
        {
          "user_display_name": "Jane",
          "content": "Thanks!",
          "created_at": "2025-12-27T11:00:00Z"
        }
      ]
    }
  ]
}
```

**æ•æ„Ÿæ¬„ä½**ï¼ˆ`includeSensitive: true` æ™‚æ‰åŒ…å«ï¼‰ï¼š

- `user_email`
- `ip_hash`
- `spam_score`
- `spam_reason`

---

## 3. UI è¦åŠƒ

### 3.1 Blog

**Posts åˆ—è¡¨é ** (`/admin/posts`)ï¼š

```
[+ New Post]  [â†‘ Import Posts]  [â†“ Export Posts]
```

| æŒ‰éˆ•               | åŠŸèƒ½                           |
| ------------------ | ------------------------------ |
| `[â†‘ Import Posts]` | ä¸Šå‚³ `.zip`ï¼ˆå¤šå€‹ `.md` æª”æ¡ˆï¼‰ |
| `[â†“ Export Posts]` | ä¸‹è¼‰ `.zip`ï¼ˆæ‰€æœ‰ postsï¼‰      |

**æ–‡ç« ç·¨è¼¯é ** (`/admin/posts/[id]/edit`)ï¼š

```
Edit Post                    [â†‘ Import .md]  [â†“ Export .md]
```

**æ–°å¢æ–‡ç« é ** (`/admin/posts/new`)ï¼š

```
New Post                                [â†‘ Import from .md]
```

**Categories é é¢** (`/admin/categories`)ï¼š

```
[+ New Category]  [â†‘ Import]  [â†“ Export]
```

---

### 3.2 Gallery

**Items é é¢** (`/admin/gallery`)ï¼š

```
[+ New Item]  [â†‘ Import Items]  [â†“ Export Items]
```

**Categories é é¢** (`/admin/gallery/categories`)ï¼š

```
[+ New Category]  [â†‘ Import]  [â†“ Export]
```

---

### 3.3 Shop

**Products é é¢** (`/admin/shop/products`)ï¼š

```
[+ New Product]  [â†‘ Import]  [â†“ Export]
```

**Product ç·¨è¼¯é ** (`/admin/shop/products/[id]`)ï¼š

```
Edit Product                 [â†‘ Import JSON]  [â†“ Export JSON]
```

**Coupons é é¢** (`/admin/shop/coupons`)ï¼š

```
[+ New Coupon]  [â†‘ Import]  [â†“ Export]
```

**Orders é é¢** (`/admin/shop/orders`)ï¼š

```
[â†“ Export]
  â˜ Include sensitive data (phone, address, invoice)
```

**Members é é¢** (`/admin/shop/members`)ï¼š

```
[â†“ Export]
  â˜ Include sensitive data (email, phone, address)
```

---

### 3.4 Website

**Site Content é é¢** (`/admin/content`)ï¼š

```
[â†‘ Import]  [â†“ Export]
```

**Landing Sections é é¢** (`/admin/landing`)ï¼š

```
[â†‘ Import]  [â†“ Export]
```

---

### 3.5 Comments

**Comments é é¢** (`/admin/comments`)ï¼š

```
[â†“ Export]
  â˜ Include sensitive data (email, IP, spam info)
```

---

### 3.6 Data Control Centerï¼ˆè³‡æ–™æ§åˆ¶ä¸­å¿ƒï¼‰

> **ç›®çš„**ï¼šæä¾›é€²éšçš„å‹•æ…‹äº¤å‰ç¯©é¸åŒ¯å‡ºåŠŸèƒ½ï¼Œæ•´åˆå•†å“éŠ·å”®èˆ‡ä½¿ç”¨è€…è¡Œç‚ºè³‡æ–™ï¼Œå¯ç›´æ¥ä¸²æ¥ AI åˆ†ææ¨¡çµ„ï¼ˆå°æ‡‰ AI_ANALYSIS_v2.mdï¼‰ã€‚

**è·¯å¾‘**ï¼š`/admin/control-center`ï¼ˆç›®å‰å·²è½åœ°ç‚ºã€Œèªæ„æœå°‹/analyticsã€Control Centerï¼›æœ¬ç¯€çš„è·¨è³‡æ–™é¡å‹åŒ¯å‡º UI ç‚º Phase 4+ è¦åŠƒï¼Œå°šæœªè½åœ°ï¼›æœ¬ PRD æ—©æœŸè‰æ¡ˆä½¿ç”¨ `/admin/system/data`ï¼‰

**åŠŸèƒ½**ï¼š

- è·¨è³‡æ–™é¡å‹çš„å‹•æ…‹ç¯©é¸åŒ¯å‡º
- **å•†å“ç¯©é¸**ï¼šä¾åˆ†é¡ã€åº«å­˜ç‹€æ…‹ã€ä¸Šæ¶ç‹€æ…‹
- **è¨‚å–®ç¯©é¸**ï¼šä¾å•†å“ã€æœƒå“¡ã€æ™‚é–“ç¯„åœ
- **æœƒå“¡ç¯©é¸**ï¼šå¤šé¸æœƒå“¡ã€å¿«é€Ÿç¯©é¸æ¨™ç±¤ï¼ˆPendingï¼Œè¦‹ä¸‹æ–¹èªªæ˜ï¼‰
- **ç•™è¨€ç¯©é¸**ï¼šä¾ Blog/Gallery/Product å…§å®¹ã€æœƒå“¡
- æ‰‹å‹•é è¦½æŒ‰éˆ•ï¼ˆæ¸›å°‘ client bundle èˆ‡ API å‘¼å«ï¼‰
- ç›´æ¥ä¸²æ¥ AI åˆ†æï¼ˆå°æ‡‰ AI_ANALYSIS_v2.md çš„ 4 å€‹æ¨¡æ¿ï¼‰

**UI è¨­è¨ˆ**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Data Control Center                                                       â”‚
â”‚  è³‡æ–™æ§åˆ¶ä¸­å¿ƒ                                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€ è³‡æ–™é¡å‹ï¼ˆå¯è¤‡é¸ï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â˜ Productsï¼ˆå•†å“ï¼‰  â˜ Ordersï¼ˆè¨‚å–®ï¼‰                                â”‚  â”‚
â”‚  â”‚ â˜ Membersï¼ˆæœƒå“¡ï¼‰   â˜ Commentsï¼ˆç•™è¨€ï¼‰                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€ å•†å“ç¯©é¸ï¼ˆç•¶é¸å– Products æˆ– Orders æ™‚é¡¯ç¤ºï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ åˆ†é¡ï¼š[å…¨éƒ¨ â–¼]  [accessories] [art] [clothing]                     â”‚  â”‚
â”‚  â”‚ ä¸Šæ¶ç‹€æ…‹ï¼šâ—‹ å…¨éƒ¨  â— åƒ…ä¸Šæ¶  â—‹ åƒ…æœªä¸Šæ¶                              â”‚  â”‚
â”‚  â”‚ åº«å­˜ç‹€æ…‹ï¼šâ— å…¨éƒ¨ï¼ˆå«å”®å®Œï¼‰  â—‹ åƒ…æœ‰åº«å­˜  â—‹ åƒ…å”®å®Œ                    â”‚  â”‚
â”‚  â”‚ [æœå°‹å•†å“...]                                                       â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚ â”‚ â˜‘ Handmade Bag (accessories) - åº«å­˜: 15                        â”‚ â”‚  â”‚
â”‚  â”‚ â”‚ â˜‘ Canvas Print (art) - åº«å­˜: 8                                 â”‚ â”‚  â”‚
â”‚  â”‚ â”‚ â˜‘ Summer Dress (clothing) - åº«å­˜: 0 [å”®å®Œ]                       â”‚ â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚ [å…¨é¸] [å–æ¶ˆå…¨é¸]  å·²é¸: 3 ä»¶å•†å“                                   â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â”‚ Note: å”®å®Œå•†å“æ˜¯ç†±éŠ·æŒ‡æ¨™ï¼Œå»ºè­°ç´å…¥ AI åˆ†æ                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€ æœƒå“¡ç¯©é¸ï¼ˆç•¶é¸å– Orders/Members/Comments æ™‚é¡¯ç¤ºï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [æœå°‹æœƒå“¡...]  çŸ­ ID / Email                                       â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚ â”‚ â˜‘ C1 John Doe (john@example.com) - 5 ç­†è¨‚å–®, LTV: $3,500       â”‚ â”‚  â”‚
â”‚  â”‚ â”‚ â˜‘ C2 Jane Smith (jane@example.com) - 3 ç­†è¨‚å–®, LTV: $1,200     â”‚ â”‚  â”‚
â”‚  â”‚ â”‚ â˜ C3 Bob Chen (bob@example.com) - 2 ç­†è¨‚å–®, LTV: $800          â”‚ â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚ [å…¨é¸] [å–æ¶ˆå…¨é¸]  å·²é¸: 2 ä½æœƒå“¡                                   â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â”‚ å¿«é€Ÿç¯©é¸ï¼š[VIP æœƒå“¡] [è¿‘ 30 å¤©æ´»èº] [æµå¤±é¢¨éšª]  â† ğŸš§ Pending        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€ ç•™è¨€å…§å®¹ç¯©é¸ï¼ˆç•¶é¸å– Comments æ™‚é¡¯ç¤ºï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â—‹ å…¨éƒ¨ç•™è¨€                                                         â”‚  â”‚
â”‚  â”‚ â—‹ ä¾ Blog æ–‡ç« ï¼š[é¸æ“‡æ–‡ç«  â–¼]                                       â”‚  â”‚
â”‚  â”‚ â—‹ ä¾ Gallery ä½œå“ï¼š[é¸æ“‡ä½œå“ â–¼]                                    â”‚  â”‚
â”‚  â”‚ â—‹ ä¾å•†å“ï¼š[é¸æ“‡å•†å“ â–¼]                                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€ æ™‚é–“ç¯„åœ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [7 å¤©] [30 å¤©] [90 å¤©] [è‡ªè¨‚]                                       â”‚  â”‚
â”‚  â”‚ å¾: [2025-01-01]  åˆ°: [2025-12-31]                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€ æ•æ„Ÿè³‡æ–™ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â˜ åŒ…å«æ•æ„Ÿè³‡æ–™ï¼ˆemail, phone, address, IPï¼‰                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€ é è¦½ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [ğŸ” é è¦½æ•¸é‡]  â† æ‰‹å‹•é»æ“ŠæŸ¥è©¢ï¼Œæ¸›å°‘ API å‘¼å«                        â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â”‚ Products: 2 ä»¶  Orders: 12 ç­†  Members: 2 ä½  Comments: 8 å‰‡       â”‚  â”‚
â”‚  â”‚ é ä¼° tokens: ~3,500  é ä¼°æˆæœ¬: $0.12                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€ åŒ¯å‡ºæ ¼å¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â—‹ JSONï¼ˆå®Œæ•´çµæ§‹ï¼Œé©åˆåŒ¯å…¥/å‚™ä»½ï¼‰                                   â”‚  â”‚
â”‚  â”‚ â—‹ CSVï¼ˆæ‰å¹³çµæ§‹ï¼Œé©åˆ Excel/Google Sheetsï¼‰                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€ æ“ä½œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [â†“ Export]                                                         â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â”‚ â”€â”€â”€ AI åˆ†æï¼ˆå°æ‡‰ AI_ANALYSIS_v2.mdï¼‰â”€â”€â”€                           â”‚  â”‚
â”‚  â”‚ [ğŸ“Š ç”¨æˆ¶è¡Œç‚ºåˆ†æ]  [ğŸ’° éŠ·å”®åˆ†æ]  [ğŸ‘¥ æœƒå“¡åˆ†ç¾¤ RFM]  [ğŸ¯ å…§å®¹æ¨è–¦]  â”‚  â”‚
â”‚  â”‚ [âœï¸ è‡ªè¨‚ Prompt]  â† Phase 3                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åŒ¯å‡ºçµæœ**ï¼ˆåˆä½µ JSONï¼‰ï¼š

```json
{
  "exportedAt": "2025-12-27T10:00:00Z",
  "filters": {
    "productIds": ["uuid-p1", "uuid-p2"],
    "memberIds": ["uuid-m1", "uuid-m2"],
    "dateRange": { "from": "2025-01-01", "to": "2025-12-31" },
    "includeSensitive": false
  },
  "products": [
    /* 2 ä»¶å•†å“ï¼ˆå« variantsï¼‰ */
  ],
  "orders": [
    /* 12 ç­†è¨‚å–® */
  ],
  "members": [
    /* 2 ä½æœƒå“¡ */
  ],
  "comments": [
    /* 8 å‰‡ç•™è¨€ */
  ]
}
```

**AI åˆ†ææ•´åˆ**ï¼ˆå°æ‡‰ AI_ANALYSIS_v2.md Â§3 åˆ†ææ¨¡æ¿ï¼‰ï¼š

| æŒ‰éˆ•                | å°æ‡‰æ¨¡æ¿   | æ‰€éœ€è³‡æ–™                     |
| ------------------- | ---------- | ---------------------------- |
| `[ğŸ“Š ç”¨æˆ¶è¡Œç‚ºåˆ†æ]` | Template 1 | Comments, Ordersï¼ˆäº’å‹•æ•¸æ“šï¼‰ |
| `[ğŸ’° éŠ·å”®åˆ†æ]`     | Template 2 | Products, Orders             |
| `[ğŸ‘¥ æœƒå“¡åˆ†ç¾¤ RFM]` | Template 3 | Members, Orders              |
| `[ğŸ¯ å…§å®¹æ¨è–¦]`     | Template 4 | Products, Orders, Comments   |

**æŒ‰éˆ•è¡Œç‚ºé‚è¼¯**ï¼š

- é»æ“Šä»»ä½• AI åˆ†ææŒ‰éˆ•æ™‚ï¼Œç³»çµ±è‡ªå‹•è£œé¸è©²åˆ†ææ‰€éœ€çš„è³‡æ–™é¡å‹
- é¡¯ç¤º Toast æç¤ºï¼šã€Œå·²è‡ªå‹•é¸å– Productsã€Orders ä»¥åŸ·è¡ŒéŠ·å”®åˆ†æã€
- ç›´æ¥é€²å…¥æˆæœ¬é ä¼°ç•«é¢

> **å¿…è¦è³‡æ–™é¡å‹å®šç¾©**ï¼šè©³è¦‹ [ai-analysis-spec.md](ai-analysis-spec.md#templates-data-types)ï¼ˆSSoT: `lib/types/ai-analysis.ts` â†’ `ANALYSIS_TEMPLATES`ï¼‰ã€‚

**æµç¨‹**ï¼š

1. ä½¿ç”¨è€…åœ¨ Control Center é¸æ“‡ç¯©é¸æ¢ä»¶
2. é»æ“Š AI åˆ†ææŒ‰éˆ•ï¼ˆè‹¥è³‡æ–™ä¸è¶³å‰‡å½ˆå‡ºè£œé¸æç¤ºï¼‰
3. ç³»çµ±å°‡ç¯©é¸å¾Œçš„æ•¸æ“šå‚³é€è‡³ AI Analysis æ¨¡çµ„
4. è‡ªå‹•å¥—ç”¨å°æ‡‰æ¨¡æ¿ï¼Œé¡¯ç¤ºæˆæœ¬é ä¼°
5. ç¢ºèªå¾ŒèƒŒæ™¯åŸ·è¡Œï¼Œå®Œæˆå¾Œé¡¯ç¤ºå ±å‘Š

**æœƒå“¡çŸ­ ID å°æ‡‰**ï¼š

> **ğŸ“ Single Source of Truth**ï¼šçŸ­ ID æ ¼å¼èˆ‡è¦å‰‡è©³è¦‹ [ai-analysis-spec.md](ai-analysis-spec.md#member-short-id)ã€‚

- åˆ—è¡¨é¡¯ç¤ºæ ¼å¼ï¼š`C1 John Doe (john@example.com)`
- æœå°‹æ”¯æ´ï¼šçŸ­ IDï¼ˆC1ï¼‰æˆ– Email
- åŒ¯å‡º/AI åˆ†ææ™‚ï¼šä½¿ç”¨åŒ¿å hashï¼ˆ`user_a1b2c3`ï¼‰
- å ±å‘Šé¡¯ç¤ºæ™‚ï¼šé‚„åŸç‚º Email

**ğŸš§ å¿«é€Ÿç¯©é¸æ¨™ç±¤ï¼ˆPendingï¼‰**ï¼š

> æ­¤åŠŸèƒ½éœ€å…ˆå®šç¾©æœƒå“¡åˆ†ç¾¤è¦å‰‡ï¼Œå¾… AI_ANALYSIS æ¨¡çµ„å®Œæˆ RFM åˆ†ç¾¤å¾Œå†å¯¦ä½œã€‚

| æ¨™ç±¤         | é è¨ˆè¦å‰‡ï¼ˆå¾…ç¢ºèªï¼‰               |
| ------------ | -------------------------------- |
| VIP æœƒå“¡     | LTV > $5,000 æˆ– è¨‚å–®æ•¸ > 10      |
| è¿‘ 30 å¤©æ´»èº | æœ€è¿‘è¨‚å–® < 30 å¤©                 |
| æµå¤±é¢¨éšª     | æœ€è¿‘è¨‚å–® > 90 å¤© ä¸” æ­·å²è¨‚å–® > 3 |

**å¯¦ä½œä¾è³´**ï¼š

- `customer_profiles` è¡¨éœ€æ–°å¢ `tags` æ¬„ä½ï¼ˆæˆ–ç”± RFM åˆ†æå‹•æ…‹è¨ˆç®—ï¼‰
- å°æ‡‰ AI_ANALYSIS_v2.md Phase 2ã€Œç‰¹å®šç”¨æˆ¶åˆ†æã€

**CSV æ ¼å¼èªªæ˜**ï¼š

| è³‡æ–™é¡å‹ | CSV æ”¯æ´ | èªªæ˜                                               |
| -------- | -------- | -------------------------------------------------- |
| Products | âœ“ åŒ¯å‡º   | æ‰å¹³åŒ–ï¼šæ¯å€‹ variant ä¸€è¡Œ                          |
| Orders   | âœ“ åŒ¯å‡º   | æ‰å¹³åŒ–ï¼šæ¯å€‹ order item ä¸€è¡Œ                       |
| Members  | âœ“ åŒ¯å‡º   | ä¸€ä½æœƒå“¡ä¸€è¡Œ                                       |
| Comments | âœ“ åŒ¯å‡º   | æ‰å¹³åŒ–ï¼šreplies å±•é–‹ç‚ºç¨ç«‹è¡Œï¼ˆparent_id æ¬„ä½é—œè¯ï¼‰ |

**CSV æ¬„ä½ç¯„ä¾‹ï¼ˆOrdersï¼‰**ï¼š

```csv
order_number,status,member_short_id,product_slug,variant_key,quantity,unit_price,total,created_at
ORD-001,completed,C1,handmade-bag,red-small,2,1500,3000,2025-12-27
ORD-001,completed,C1,canvas-print,default,1,800,800,2025-12-27
```

**CSV æ¬„ä½ç¯„ä¾‹ï¼ˆProductsï¼‰**ï¼š

```csv
product_slug,variant_key,name_en,name_zh,category,sku,price_cents,stock,is_visible
handmade-bag,red-small,Handmade Bag,æ‰‹å·¥åŒ…,accessories,HB-RED-S,150000,10,true
handmade-bag,blue-large,Handmade Bag,æ‰‹å·¥åŒ…,accessories,HB-BLUE-L,180000,5,true
canvas-print,default,Canvas Print,ç¹ªç•«å°åˆ·,art,CP-001,80000,20,true
```

**CSV æ¬„ä½ç¯„ä¾‹ï¼ˆMembersï¼‰**ï¼š

```csv
short_id,display_name,order_count,ltv_cents,first_order_at,last_order_at,tags,is_blocked
C1,John Doe,5,750000,2025-01-15,2025-12-20,"vip,repeat-buyer",false
C2,Jane Smith,3,320000,2025-03-10,2025-11-05,loyal,false
```

**CSV æ¬„ä½ç¯„ä¾‹ï¼ˆCommentsï¼‰**ï¼š

```csv
target_type,target_slug,user_display_name,content,is_approved,like_count,created_at,parent_id
post,my-first-post,John,Great post!,true,5,2025-12-27,
post,my-first-post,Jane,Thanks!,true,2,2025-12-27,comment-uuid-1
product,handmade-bag,Bob,Love this bag!,true,10,2025-12-26,
```

> **èªªæ˜**ï¼šComments çš„ replies å±•é–‹ç‚ºç¨ç«‹è¡Œï¼Œä½¿ç”¨ `parent_id` æ¬„ä½é—œè¯çˆ¶ç•™è¨€ã€‚

**æ³¨æ„**ï¼š

- CSV åƒ…æ”¯æ´**åŒ¯å‡º**ï¼Œä¸æ”¯æ´åŒ¯å…¥ï¼ˆå·¢ç‹€çµæ§‹é›£ä»¥é‚„åŸï¼‰
- CSV æ ¼å¼**åªèƒ½å–®é¸ä¸€ç¨®è³‡æ–™é¡å‹**ï¼Œå¤šé¸æ™‚è‡ªå‹•åˆ‡å› JSON

**CSV é¸é …çš„ UI è¡Œç‚º**ï¼š

| ä½¿ç”¨è€…å‹•ä½œ                    | UI åæ‡‰                                                              |
| ----------------------------- | -------------------------------------------------------------------- |
| å‹¾é¸å–®ä¸€è³‡æ–™é¡å‹              | JSON / CSV çš†å¯é¸                                                    |
| å‹¾é¸å¤šç¨®è³‡æ–™é¡å‹              | CSV é¸é …è®Šç‚º disabledï¼Œé¡¯ç¤º tooltipï¼šã€ŒCSV åƒ…æ”¯æ´å–®ä¸€è³‡æ–™é¡å‹ã€      |
| å…ˆé¸ CSV å†å‹¾é¸ç¬¬äºŒç¨®è³‡æ–™é¡å‹ | è‡ªå‹•åˆ‡å› JSONï¼Œé¡¯ç¤ºæç¤ºï¼šã€Œå·²åˆ‡æ›ç‚º JSONï¼ˆCSV ä¸æ”¯æ´å¤šç¨®è³‡æ–™é¡å‹ï¼‰ã€ |

**State ç®¡ç†**ï¼š

ç¯©é¸æ¢ä»¶ä½¿ç”¨ URL searchParams å„²å­˜ï¼ˆNext.js `useSearchParams`ï¼‰ï¼Œæ”¯æ´ï¼š

- åˆ†äº«é€£çµï¼šè¤‡è£½ URL å³å¯åˆ†äº«ç•¶å‰ç¯©é¸ç‹€æ…‹
- é é¢é‡æ•´ï¼šé‡æ•´å¾Œç¯©é¸æ¢ä»¶ä¿ç•™
- ç€è¦½å™¨æ­·å²ï¼šå¯ç”¨ä¸Šä¸€é /ä¸‹ä¸€é åˆ‡æ›ç¯©é¸ç‹€æ…‹

```
ç¯„ä¾‹ URLï¼š
/admin/control-center?dataTypes=products,orders&productIds=uuid1,uuid2&dateFrom=2025-01-01&dateTo=2025-12-31
```

---

### 3.7 å…¥å£ä¸¦å­˜ç­–ç•¥

| Phase     | å„é é¢ç¨ç«‹æŒ‰éˆ•                  | Data Control Center              |
| --------- | ------------------------------- | -------------------------------- |
| Phase 1-3 | âœ… ä¸»è¦å…¥å£                     | âŒ æœªå¯¦ä½œ                        |
| Phase 4+  | âœ… ä¿ç•™ï¼ˆå–®ä¸€è³‡æ–™é¡å‹å¿«é€Ÿæ“ä½œï¼‰ | âœ… ä¸»è¦å…¥å£ï¼ˆå¤šé¸/ç¯©é¸/AI æ•´åˆï¼‰ |

**è¨­è¨ˆåŸå› **ï¼š

- å„é é¢æŒ‰éˆ•ï¼šæ–¹ä¾¿å–®ä¸€è³‡æ–™é¡å‹çš„å¿«é€ŸåŒ¯å…¥åŒ¯å‡º
- Control Centerï¼šé©åˆè·¨è³‡æ–™é¡å‹ç¯©é¸ã€æ‰¹é‡æ“ä½œã€AI åˆ†æå‰ç½®ä½œæ¥­

**ä¸åˆä½µåŸå› **ï¼š

- æ—¥å¸¸æ“ä½œï¼ˆå¦‚å‚™ä»½å–®ä¸€æ–‡ç« åˆ†é¡ï¼‰ä¸éœ€é€²å…¥ Control Center
- Control Center é é¢è¼‰å…¥è¼ƒé‡ï¼ˆå¤šå€‹ç¯©é¸å™¨ï¼‰

---

## 4. åŒ¯å…¥æµç¨‹

### 4.1 æ¨™æº–æµç¨‹

```
Step 1: é¸æ“‡/ä¸Šå‚³æª”æ¡ˆ
        â†“
Step 2: ç³»çµ±è§£æä¸¦é©—è­‰
        - æ ¼å¼é©—è­‰
        - æ¬„ä½å°æ‡‰é©—è­‰
        - é—œè¯å­˜åœ¨æ€§æª¢æŸ¥ï¼ˆå¦‚ category slugï¼‰
        â†“
Step 3: Dry Run é è¦½
        - é¡¯ç¤ºï¼šæ–°å¢ X ç­†ã€æ›´æ–° Y ç­†ã€ç•¥é Z ç­†
        - é¡¯ç¤ºï¼šé©—è­‰è­¦å‘Š/éŒ¯èª¤
        â†“
Step 4: ç¢ºèªåŸ·è¡Œ
        - è‹¥æœ‰éŒ¯èª¤ï¼Œå¿…é ˆä¿®æ­£å¾Œé‡æ–°ä¸Šå‚³
        - è‹¥åƒ…æœ‰è­¦å‘Šï¼Œå¯é¸æ“‡ç¹¼çºŒæˆ–å–æ¶ˆ
        â†“
Step 5: åŸ·è¡ŒåŒ¯å…¥
        - é¡¯ç¤ºé€²åº¦
        - å®Œæˆå¾Œé¡¯ç¤ºæ‘˜è¦
        â†“
Step 6: è§¸ç™¼ Embedding ç”Ÿæˆï¼ˆè‹¥ Module C å·²å•Ÿç”¨ï¼‰
        - éåŒæ­¥èƒŒæ™¯åŸ·è¡Œ
        - ä¸é˜»å¡åŒ¯å…¥å®Œæˆé€šçŸ¥
```

### 4.1.1 Embedding è§¸ç™¼æ©Ÿåˆ¶ï¼ˆModule C æ•´åˆï¼‰

ç•¶ Module Cï¼ˆSupabase AIï¼‰å·²å•Ÿç”¨æ™‚ï¼ŒåŒ¯å…¥å®Œæˆå¾Œæœƒè‡ªå‹•è§¸ç™¼ embedding ç”Ÿæˆï¼š

| åŒ¯å…¥é¡å‹      | Embedding è™•ç†          |
| ------------- | ----------------------- |
| Products      | éåŒæ­¥ç”Ÿæˆï¼Œæ¯ç­†ç´„ 1 ç§’ |
| Posts         | éåŒæ­¥ç”Ÿæˆï¼Œæ¯ç­†ç´„ 1 ç§’ |
| Gallery Items | éåŒæ­¥ç”Ÿæˆï¼Œæ¯ç­†ç´„ 1 ç§’ |
| å…¶ä»–è³‡æ–™      | ä¸å»ºç«‹ embedding        |

**æ‰¹é‡åŒ¯å…¥ï¼ˆ100 ç­†ï¼‰é ä¼°æ™‚é–“**ï¼š

- åŒ¯å…¥æœ¬èº«ï¼š5-10 ç§’ï¼ˆåŒæ­¥å®Œæˆï¼‰
- Embedding ç”Ÿæˆï¼š1-2 åˆ†é˜ï¼ˆèƒŒæ™¯å®Œæˆï¼‰

> ä½¿ç”¨è€…åœ¨åŒ¯å…¥å®Œæˆå¾Œå³å¯æ“ä½œï¼Œç„¡éœ€ç­‰å¾… embedding ç”Ÿæˆã€‚

**Phase é‚Šç•Œè¡Œç‚º**ï¼š

| æ¢ä»¶                            | åŒ¯å…¥å¾Œè¡Œç‚º              | UI é¡¯ç¤º                               |
| ------------------------------- | ----------------------- | ------------------------------------- |
| Phase < 5ï¼ˆç„¡ OPENAI_API_KEYï¼‰  | è·³é embedding ç”Ÿæˆ     | ç„¡ç‰¹æ®Šæç¤º                            |
| Phase â‰¥ 5ï¼ˆæœ‰ OPENAI_API_KEYï¼‰  | èƒŒæ™¯è§¸ç™¼ embedding ç”Ÿæˆ | Toast: "Embedding ç”Ÿæˆä¸­..."          |
| Phase â‰¥ 5 ä½† embedding ç”Ÿæˆå¤±æ•— | è¨˜éŒ„å¤±æ•—é …ç›®            | Admin é€šçŸ¥: "X ç­† embedding ç”Ÿæˆå¤±æ•—" |

> ä½¿ç”¨è€…å¯åœ¨ `/admin/embeddings` æŸ¥çœ‹ç‹€æ…‹èˆ‡é‡è©¦ã€‚

**è§¸ç™¼æ©Ÿåˆ¶**ï¼š

```typescript
// lib/modules/import-export/import-*-io.ts åŒ¯å…¥å®Œæˆå¾Œ
if (process.env.OPENAI_API_KEY) {
  await queueEmbeddingGeneration(importedItems);
} else {
  console.warn("OPENAI_API_KEY not set, skipping embedding generation");
}
```

**Phase ç›¸ä¾æ€§**ï¼š

- è‹¥ `OPENAI_API_KEY` ç’°å¢ƒè®Šæ•¸æœªè¨­å®šï¼ˆPhase 5 æœªå®Œæˆï¼‰ï¼ŒåŒ¯å…¥æµç¨‹è‡ªå‹•è·³é Embedding è§¸ç™¼
- å¾… Phase 5 å®Œæˆä¸¦è¨­å®šç’°å¢ƒè®Šæ•¸å¾Œï¼Œå¯é€éã€Œæ‰¹æ¬¡åˆå§‹åŒ–ã€åŠŸèƒ½å°æ—¢æœ‰è³‡æ–™è£œè·‘ embeddingï¼ˆè©³è¦‹ [SUPABASE_AI.md Â§4.2](embeddings-semantic-search-spec.md#42-æ‰¹æ¬¡åˆå§‹åŒ–)ï¼‰

### 4.2 è¡çªè™•ç†ç­–ç•¥

| æƒ…å¢ƒ                                 | é è¨­è¡Œç‚º               |
| ------------------------------------ | ---------------------- |
| slug å·²å­˜åœ¨                          | æ›´æ–°ï¼ˆè¦†è“‹ï¼‰           |
| åƒç…§ä¸å­˜åœ¨ï¼ˆå¦‚ categoryï¼‰            | å ±éŒ¯                   |
| æ¬„ä½æ ¼å¼éŒ¯èª¤                         | è©²ç­†ç•¥éï¼Œç¹¼çºŒè™•ç†å…¶ä»– |
| ç³»çµ±è¨ˆç®—æ¬„ä½ï¼ˆå¦‚ `popularity_rank`ï¼‰ | å¿½ç•¥ï¼Œç”±ç³»çµ±é‡æ–°è¨ˆç®—   |

### 4.2.1 ç³»çµ±è¨ˆç®—æ¬„ä½è™•ç†

åŒ¯å…¥æ™‚ä»¥ä¸‹æ¬„ä½æœƒè¢«**å¿½ç•¥**ï¼Œç”±ç³»çµ±é‡æ–°è¨ˆç®—ï¼š

| æ¬„ä½                   | èªªæ˜     | é‡ç®—æ™‚æ©Ÿ               |
| ---------------------- | -------- | ---------------------- |
| `popularity_rank`      | ç†±é–€æ’å | æ¯æ—¥ Cron Job          |
| `embedding`            | èªæ„å‘é‡ | åŒ¯å…¥å¾Œç«‹å³ï¼ˆasyncï¼‰    |
| `created_at`           | å»ºç«‹æ™‚é–“ | è‹¥ç‚ºæ–°å¢ï¼Œä½¿ç”¨ç•¶å‰æ™‚é–“ |
| `updated_at`           | æ›´æ–°æ™‚é–“ | ä¸€å¾‹ä½¿ç”¨ç•¶å‰æ™‚é–“       |
| `used_count` (Coupons) | ä½¿ç”¨æ¬¡æ•¸ | ä¸è¦†è“‹ï¼Œä¿ç•™åŸå€¼       |

> **åŸå› **: é€™äº›æ¬„ä½ç”±ç³»çµ±ç¶­è­·ï¼ŒåŒ¯å…¥è³‡æ–™ä¸æ‡‰è¦†è“‹ï¼Œé¿å…è³‡æ–™ä¸ä¸€è‡´ã€‚

---

### 4.3 Dry Run Previewï¼ˆè©¦åŸ·è¡Œé è¦½ï¼‰

> **å®šç¾©**ï¼šåœ¨å¯¦éš›å¯«å…¥è³‡æ–™åº«ä¹‹å‰ï¼Œå…ˆæ¨¡æ“¬åŸ·è¡ŒåŒ¯å…¥éç¨‹ï¼Œè®“ä½¿ç”¨è€…é è¦½æœƒç™¼ç”Ÿä»€éº¼äº‹ã€‚

**é‹ä½œæµç¨‹**ï¼š

1. ç³»çµ±è®€å–ä¸Šå‚³çš„åŒ¯å…¥æª”æ¡ˆ
2. åŸ·è¡Œå®Œæ•´é©—è­‰ï¼ˆæ ¼å¼ã€æ¬„ä½ã€é—œè¯ï¼‰
3. é¡¯ç¤ºé è¦½çµæœï¼Œä½†**ä¸å¯«å…¥è³‡æ–™åº«**
4. ä½¿ç”¨è€…ç¢ºèªå¾Œæ‰å¯¦éš›åŸ·è¡Œ

**é è¦½ UI ç¯„ä¾‹**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŒ¯å…¥é è¦½ (Dry Run)                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  ğŸ“Š çµ±è¨ˆæ‘˜è¦                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  âœ“ å°‡æ–°å¢: 15 ç­†è¨˜éŒ„                                                â”‚  â”‚
â”‚  â”‚  âœ“ å°‡æ›´æ–°: 3 ç­†è¨˜éŒ„ï¼ˆslug å·²å­˜åœ¨ï¼Œå°‡è¦†è“‹ï¼‰                           â”‚  â”‚
â”‚  â”‚  âš  ç•¥é: 1 ç­†è¨˜éŒ„ï¼ˆéå¿…è¦éŒ¯èª¤ï¼‰                                      â”‚  â”‚
â”‚  â”‚  âœ— éŒ¯èª¤: 2 ç­†è¨˜éŒ„                                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â”‚  âš  è­¦å‘Šæ¸…å–®                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  â€¢ ç¬¬ 8 è¡Œ "old-post.md": å°‡è¦†è“‹ç¾æœ‰æ–‡ç«                              â”‚  â”‚
â”‚  â”‚  â€¢ ç¬¬ 12 è¡Œ: cover_image_url ç‚ºç©ºï¼Œå°‡ä½¿ç”¨é è¨­åœ–ç‰‡                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â”‚  âœ— éŒ¯èª¤æ¸…å–®ï¼ˆå¿…é ˆä¿®æ­£ï¼‰                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  â€¢ ç¬¬ 5 è¡Œ "broken-post.md": category "xyz" ä¸å­˜åœ¨                   â”‚  â”‚
â”‚  â”‚  â€¢ ç¬¬ 17 è¡Œ "incomplete.md": ç¼ºå°‘å¿…è¦æ¬„ä½ title_en                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â”‚  [å–æ¶ˆ]                    [å¿½ç•¥è­¦å‘Šä¸¦åŸ·è¡Œ]      [ä¿®æ­£å¾Œé‡æ–°ä¸Šå‚³]          â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æŒ‰éˆ•é‚è¼¯**ï¼š
| ç‹€æ…‹ | å¯ç”¨æŒ‰éˆ• |
|------|----------|
| ç„¡éŒ¯èª¤ã€ç„¡è­¦å‘Š | `[ç¢ºèªåŸ·è¡Œ]` |
| æœ‰è­¦å‘Šã€ç„¡éŒ¯èª¤ | `[å¿½ç•¥è­¦å‘Šä¸¦åŸ·è¡Œ]` `[å–æ¶ˆ]` |
| æœ‰éŒ¯èª¤ | `[ä¿®æ­£å¾Œé‡æ–°ä¸Šå‚³]` `[å–æ¶ˆ]`ï¼ˆä¸å¯ç›´æ¥åŸ·è¡Œï¼‰|

**å¥½è™•**ï¼š

- é¿å…åŒ¯å…¥éŒ¯èª¤è³‡æ–™å¾Œæ‰ç™¼ç¾å•é¡Œ
- æå‰çœ‹åˆ°å“ªäº›æ˜¯æ–°å¢ã€å“ªäº›æœƒè¦†è“‹ç¾æœ‰è³‡æ–™
- ç™¼ç¾æ ¼å¼éŒ¯èª¤å¯ä»¥å…ˆä¿®æ­£æª”æ¡ˆå†é‡æ–°åŒ¯å…¥
- æ¸›å°‘è³‡æ–™æ±™æŸ“å’Œå›æ»¾æˆæœ¬

**æŠ€è¡“å¯¦ä½œ**ï¼š

æ¡ç”¨ã€Œç´”é©—è­‰æ¨¡å¼ã€ï¼ˆValidation-onlyï¼‰ï¼Œä¸ä½¿ç”¨ database transactionï¼š

1. è®€å–ä¸Šå‚³æª”æ¡ˆ
2. è§£æä¸¦é©—è­‰æ ¼å¼
3. æŸ¥è©¢è³‡æ–™åº«æª¢æŸ¥é—œè¯å­˜åœ¨æ€§ï¼ˆSELECT onlyï¼‰
4. æŸ¥è©¢ slug æ˜¯å¦å·²å­˜åœ¨ä»¥åˆ¤æ–·æ–°å¢/æ›´æ–°
5. å½™æ•´çµæœå›å‚³å‰ç«¯é¡¯ç¤º

**åŸå› **ï¼šé¿å…å¤§é‡è³‡æ–™æ™‚çš„ transaction é–‹éŠ·èˆ‡ lock å•é¡Œã€‚

---

### 4.4 éŒ¯èª¤æ¢å¾©ç­–ç•¥ï¼ˆError Recoveryï¼‰

> **æ±ºç­–**: æ¡ç”¨ DB Transaction å…¨éƒ¨ Rollback ç­–ç•¥ï¼Œç¢ºä¿è³‡æ–™ä¸€è‡´æ€§ã€‚

#### 4.4.1 éŒ¯èª¤æ¢å¾©é¸é …ï¼ˆå·²æ±ºå®šï¼‰

| å•é¡Œ                             | é¸é …                                   | æ±ºå®š   | ç†ç”±                       |
| -------------------------------- | -------------------------------------- | ------ | -------------------------- |
| **A. åŒ¯å…¥è¢«ä¸­æ–·ï¼ˆç¶²è·¯/ä¼ºæœå™¨ï¼‰** | A1. å¾é ­é‡ä¾†<br>A2. ç¹¼çºŒæœªå®Œæˆçš„       | **A2** | é¿å…é‡è¤‡åŒ¯å…¥å·²æˆåŠŸçš„é …ç›®   |
| **B. éƒ¨åˆ†å¤±æ•—**                  | B1. ä¸ä¿ç•™éƒ¨åˆ†æˆåŠŸ<br>B2. ä¿ç•™éƒ¨åˆ†æˆåŠŸ | **B1** | ä¿æŒè³‡æ–™ä¸€è‡´æ€§ï¼Œé¿å…åŠæˆå“ |
| **C. å›æ»¾ç­–ç•¥**                  | C1. å…¨éƒ¨ Rollback<br>C2. åƒ…å›æ»¾å¤±æ•—çš„  | **C1** | DB Transaction ä¿è­‰        |

#### 4.4.2 å¯¦ä½œæ–¹å¼

```typescript
// lib/modules/import-export/import-*-io.ts

export async function importBatch(items: ImportItem[]): Promise<ImportResult> {
  // ä½¿ç”¨ Supabase transaction
  const { error } = await supabase.rpc("import_batch", {
    items: JSON.stringify(items),
  });

  if (error) {
    // å…¨éƒ¨å›æ»¾ï¼Œä¸ä¿ç•™éƒ¨åˆ†æˆåŠŸ
    return {
      success: false,
      error: error.message,
      processed: 0,
      total: items.length,
    };
  }

  return {
    success: true,
    processed: items.length,
    total: items.length,
  };
}
```

#### 4.4.3 ä¸­æ–·æ¢å¾©æµç¨‹

ç•¶åŒ¯å…¥è¢«ä¸­æ–·æ™‚ï¼ˆç¶²è·¯å•é¡Œã€ä¼ºæœå™¨éŒ¯èª¤ï¼‰ï¼š

```
Step 1: ç³»çµ±åµæ¸¬åˆ°ä¸­æ–·
        - è¨˜éŒ„å·²è™•ç†çš„ itemsï¼ˆå·² commit çš„ batchï¼‰
        - è¨˜éŒ„æœªè™•ç†çš„ itemsï¼ˆpending batchï¼‰
        â†“
Step 2: ä½¿ç”¨è€…é‡æ–°ä¸Šå‚³ï¼ˆæˆ–å¾å¿«å–æ¢å¾©ï¼‰
        - ç³»çµ±é¡¯ç¤ºï¼šã€Œåµæ¸¬åˆ°ä¸Šæ¬¡åŒ¯å…¥ä¸­æ–·ï¼Œæ˜¯å¦ç¹¼çºŒï¼Ÿã€
        - é¡¯ç¤ºï¼šã€Œå·²å®Œæˆ X ç­†ï¼Œå°šé¤˜ Y ç­†ã€
        â†“
Step 3: ä½¿ç”¨è€…é¸æ“‡
        - [ç¹¼çºŒæœªå®Œæˆçš„] â†’ å¾ä¸­æ–·é»ç¹¼çºŒ
        - [å¾é ­é–‹å§‹] â†’ æ¸…é™¤å¿«å–ï¼Œé‡æ–°åŒ¯å…¥ï¼ˆå¯èƒ½ç”¢ç”Ÿé‡è¤‡ï¼‰
        â†“
Step 4: åŸ·è¡Œ
        - è‹¥ç¹¼çºŒï¼šè·³éå·²å®Œæˆçš„ itemsï¼ˆä¾ slug åˆ¤æ–·ï¼‰
        - è‹¥é‡æ–°é–‹å§‹ï¼šè¦†è“‹å·²å­˜åœ¨çš„ items
```

#### 4.4.4 æ‰¹æ¬¡è™•ç†ç­–ç•¥

ç‚ºæ”¯æ´ä¸­æ–·æ¢å¾©ï¼Œå¤§é‡åŒ¯å…¥æ¡ç”¨åˆ†æ‰¹ commitï¼š

| é …ç›®                 | è¨­å®š                           |
| -------------------- | ------------------------------ |
| æ‰¹æ¬¡å¤§å°             | 10 ç­†/batch                    |
| æ¯æ‰¹ç¨ç«‹ Transaction | æ˜¯ï¼ˆæ‰¹æ¬¡é–“å¯æ¢å¾©ï¼‰             |
| æ‰¹æ¬¡å…§å¤±æ•—           | è©²æ‰¹å…¨éƒ¨å›æ»¾                   |
| æ‰¹æ¬¡é–“å¤±æ•—           | å·²å®Œæˆæ‰¹æ¬¡ä¿ç•™ï¼Œå¾å¤±æ•—æ‰¹æ¬¡ç¹¼çºŒ |

**ç¯„ä¾‹ï¼ˆåŒ¯å…¥ 35 ç­†ï¼‰**ï¼š

```
Batch 1 (1-10):   âœ“ Committed
Batch 2 (11-20):  âœ“ Committed
Batch 3 (21-30):  âœ— ç¬¬ 25 ç­†å¤±æ•— â†’ Batch 3 å…¨éƒ¨å›æ»¾
                  ä¸­æ–·é»ï¼šç¬¬ 20 ç­†
Batch 4 (31-35):  æœªåŸ·è¡Œ

â†’ æ¢å¾©æ™‚å¾ Batch 3 (21-30) é‡æ–°é–‹å§‹
```

---

## 5. æŠ€è¡“æ¶æ§‹ï¼ˆä¾å¾ª ARCHITECTURE.mdï¼‰

### 5.1 æ¨¡çµ„çµæ§‹

```
lib/
â”œâ”€â”€ import-export/
â”‚   â”œâ”€â”€ export-io.ts             # (server-only) export entry (blog re-export)
â”‚   â”œâ”€â”€ import-io.ts             # (server-only) import entry (blog re-export)
â”‚   â”œâ”€â”€ export-blog-io.ts        # Blog export (ZIP)
â”‚   â”œâ”€â”€ import-blog-io.ts        # Blog import facade (re-export)
â”‚   â”œâ”€â”€ import-blog-preview-io.ts# Blog import preview (ZIP)
â”‚   â”œâ”€â”€ import-blog-apply-io.ts  # Blog import apply (ZIP)
â”‚   â”œâ”€â”€ export-gallery-io.ts     # Gallery export
â”‚   â”œâ”€â”€ import-gallery-io.ts     # Gallery import facade (re-export)
â”‚   â”œâ”€â”€ import-gallery-items-io.ts      # Gallery items import (preview/apply)
â”‚   â”œâ”€â”€ import-gallery-categories-io.ts # Gallery categories import (preview/apply)
â”‚   â”œâ”€â”€ export-shop-io.ts        # Shop export (products/coupons/orders/members)
â”‚   â”œâ”€â”€ import-shop-io.ts        # Shop import (products/coupons preview/apply)
â”‚   â”œâ”€â”€ export-content-io.ts     # Site content + landing export
â”‚   â”œâ”€â”€ import-content-io.ts     # Site content + landing import (preview/apply)
â”‚   â”œâ”€â”€ export-comments-io.ts    # Comments export (export-only)
â”‚   â”œâ”€â”€ formatters/              # (pure)
â”‚   â”œâ”€â”€ parsers/                 # (pure)
â”‚   â””â”€â”€ validators/              # (pure)
â””â”€â”€ types/
    â””â”€â”€ import-export.ts         # Shared types
```

### 5.2 æ¶æ§‹ç´„æŸå°æ‡‰

| ç´„æŸï¼ˆfrom ARCHITECTURE.mdï¼‰ | æœ¬åŠŸèƒ½å°æ‡‰                                                                                               |
| ---------------------------- | -------------------------------------------------------------------------------------------------------- |
| IO boundariesï¼ˆÂ§3.4ï¼‰        | æ‰€æœ‰ DB æ“ä½œé›†ä¸­æ–¼ `lib/modules/import-export/*-io.ts`ï¼ˆapp layer åªåš validate â†’ call libï¼‰                     |
| IO module sizeï¼ˆÂ§3.4ï¼‰       | æ¯å€‹ `*-io.ts` æª”æ¡ˆä¸è¶…é 300 è¡Œï¼ˆé ä¼°å„æª”ç´„ 80-150 è¡Œï¼‰                                                 |
| Pure modulesï¼ˆÂ§4.3ï¼‰         | formatters/parsers/validators ç‚ºç´”å‡½å¼ï¼Œå¯å–®æ¸¬                                                           |
| Server-onlyï¼ˆÂ§4.5, Â§4.6ï¼‰    | æ‰€æœ‰ IO æª”æ¡ˆé–‹é ­å¿…é ˆ `import 'server-only';`ï¼Œ`gray-matter`/`jszip` ä¸é€² public bundle                   |
| Single source of truth       | Types å®šç¾©æ–¼ `lib/types/import-export.ts`                                                                |
| **Heavy deps server-only**   | `gray-matter`, `jszip`, `papaparse`, `exceljs` åƒ…èƒ½å­˜åœ¨æ–¼ `lib/modules/import-export/**`ï¼ˆä¸å¾—é€² client bundleï¼‰ |

---

## 6. å®‰å…¨æ€§è€ƒé‡

### 6.1 æ¬Šé™æ§åˆ¶

| è§’è‰²   | Export                     | Import   |
| ------ | -------------------------- | -------- |
| Owner  | âœ“ å…¨åŠŸèƒ½                   | âœ“ å…¨åŠŸèƒ½ |
| Editor | âœ“ åƒ…å…§å®¹é¡ï¼ˆBlog/Galleryï¼‰ | âœ— ç¦æ­¢   |
| Public | âœ—                          | âœ—        |

### 6.2 æ•æ„Ÿè³‡æ–™è™•ç†

**åŒ¯å‡ºæ™‚å¯æ’é™¤çš„æ¬„ä½**ï¼š

| è³‡æ–™é¡å‹ | æ•æ„Ÿæ¬„ä½                                                                         |
| -------- | -------------------------------------------------------------------------------- |
| Orders   | `recipient_phone`, `recipient_address`, `invoice_data`, `gateway_transaction_id` |
| Members  | `email`, `phone`, `address_json`                                                 |
| Comments | `user_email`, `ip_hash`, `spam_score`, `spam_reason`                             |

### 6.3 æª”æ¡ˆå¤§å°é™åˆ¶

| æ ¼å¼         | ä¸Šå‚³é™åˆ¶ | è¨˜éŒ„æ•¸é™åˆ¶ |
| ------------ | -------- | ---------- |
| JSON         | 10 MB    | 100 ç­†     |
| Markdown.zip | 20 MB    | 100 ç­†     |

---
